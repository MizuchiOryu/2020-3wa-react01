<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello React</title>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://raw.githack.com/playoutprod/2020-3wa-react01/master/01_FORMULAIRES_LIFTINGUP/exercices/slider/slider.css" media="all"/>
  </head>
  <body>
    <div id="slider"></div>
    <!-- compilation JSX => JS -->
    <script type="text/babel">

      class Slider extends React.Component{

        constructor(props){
          super(props);
          this.data = null;
          this.state = {
            dataLoaded : false,
            imagesLoaded : false
          }
        }
        loadData(url,callback) {
          fetch(url)
          .then(response => {
              if (!response.ok) {
                  throw new Error("HTTP error " + response.status);
              }
              return response.json();
          })
          .then(json => {
             callback(json);
          })
        }
        onDataLoaded = (data) => {
          this.data = data;
          this.data.images.forEach( (image) => {
            image.loaded=false;
            const img = new Image();
            img.src = `${this.data.path}/${this.data.full_folder}/${image.name}.${this.data.extension}?raw=true`;
            img.onload = () => {

                image.loaded=true;
                this.checkLoad();
            };
          })
          this.setState({
            dataLoaded : true
          })
        }
        checkLoad = () => {
          if(!this.data.images.find(image => image.loaded === false)){
            this.setState({
              imagesLoaded : true
            })
          }
        }

        render(){
          return(
          <React.Fragment>

            <div className={"layer"+(this.state.imagesLoaded ? " hide" : "")}>
                <div id="loader-1" className="loader"></div>
            </div>

            <div className="layer content">
              <div className="view">
                <ul className="full">
                  {this.data &&
                    this.data.images.map((image,k)=>{return(
                      <li key={k}><img loaded={image.loaded ? 1:0} width="400" height="320" src={`${this.data.path}/${this.data.full_folder}/${image.name}.${this.data.extension}?raw=true`}/></li>
                    )})
                  }
                </ul>
              </div>
            </div>

          </React.Fragment>
          )
        }
        componentDidMount(){
          this.loadData("https://raw.githubusercontent.com/playoutprod/2020-3wa-react01/master/01_FORMULAIRES_LIFTINGUP/exercices/slider/data.json",this.onDataLoaded)
        }
      }

     ReactDOM.render(
         <Slider/>,
         document.getElementById("slider")
     );

    </script>
  </body>
</html>
